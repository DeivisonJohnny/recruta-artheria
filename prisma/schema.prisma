generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  password  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  searches   Search[]
  jobs       Job[]
  candidates Candidate[]

  @@map("users")
}

// Tabela unificada para candidatos de qualquer fonte
model Candidate {
  id     String @id @default(cuid())
  userId String

  // Campo que indica a origem do candidato
  source String // "linkedin" | "resume" | "manual"

  // Identificadores únicos por fonte
  linkedinId  String? @unique // ID do LinkedIn (ex: deivisonjohnny) - apenas para source="linkedin"
  linkedinUrl String? // URL completa do LinkedIn

  // Dados pessoais (comum a todas as fontes)
  fullName String?
  email    String?
  phone    String?
  location String?
  photoUrl String? // Foto de perfil (principalmente do LinkedIn)

  // Perfil profissional
  headline String? // Título profissional
  about    String? // Resumo/Sobre/Objetivo profissional
  summary  String? // Resumo profissional alternativo

  // Dados estruturados (JSON)
  experience     Json? // Array de experiências profissionais
  education      Json? // Array de formação acadêmica
  skills         Json? // Array de habilidades/competências
  languages      Json? // Array de idiomas
  certifications Json? // Array de certificações
  projects       Json? // Array de projetos

  // URLs adicionais
  portfolioUrl String?
  githubUrl    String?

  // Campos específicos para candidatos de currículo
  resumeFileName String? // Nome do arquivo original do currículo
  resumeFileUrl  String? // URL do arquivo no storage (futuro)

  // Dados brutos e metadados
  extractedData Json? // Dados brutos extraídos (IA ou scraping)
  rawData       Json? // Dados brutos da API (ex: ScrapingDog)

  // Status de processamento
  processingStatus String? // "pending" | "processing" | "completed" | "failed"
  processingError  String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relações
  user          User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  searchResults SearchResult[]
  jobCandidates JobCandidate[]

  @@index([userId])
  @@index([source])
  @@index([email])
  @@index([linkedinId])
  @@index([processingStatus])
  @@map("candidates")
}

model Search {
  id           String   @id @default(cuid())
  userId       String
  title        String
  profession   String?
  location     String?
  technologies String[] // Array de tecnologias
  keywords     String[] // Palavras-chave adicionais
  createdAt    DateTime @default(now())

  user    User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  results SearchResult[]

  @@index([userId])
  @@map("searches")
}

model SearchResult {
  id             String   @id @default(cuid())
  searchId       String
  candidateId    String
  linkedinUrl    String // URL completa do perfil
  relevanceScore Float? // Score de relevância (opcional, para AI)
  createdAt      DateTime @default(now())

  search    Search    @relation(fields: [searchId], references: [id], onDelete: Cascade)
  candidate Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)

  @@unique([searchId, candidateId])
  @@index([searchId])
  @@index([candidateId])
  @@map("search_results")
}

model Job {
  id              String   @id @default(cuid())
  userId          String
  title           String
  description     String
  requirements    String[] // Array de requisitos
  location        String?
  technologies    String[] // Tecnologias necessárias
  experienceLevel String? // Junior, Pleno, Senior, etc.
  employmentType  String? // CLT, PJ, etc.
  salaryRange     String?
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  user       User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  candidates JobCandidate[]

  @@index([userId])
  @@index([isActive])
  @@map("jobs")
}

model JobCandidate {
  id          String   @id @default(cuid())
  jobId       String
  candidateId String
  aiAnalysis  String? // Análise do Gemini AI
  matchScore  Float? // Score de compatibilidade (0-100)
  status      String   @default("pending") // pending, reviewed, contacted, rejected
  notes       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  job       Job       @relation(fields: [jobId], references: [id], onDelete: Cascade)
  candidate Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)

  @@unique([jobId, candidateId])
  @@index([jobId])
  @@index([candidateId])
  @@index([status])
  @@map("job_candidates")
}
